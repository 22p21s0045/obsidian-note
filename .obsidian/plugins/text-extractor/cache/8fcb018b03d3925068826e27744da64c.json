{"path":"Lecture Kmutt/INT208 LAB/materials/INT206_Assignment1_2023_02_v1.pdf","text":"INT206 Assignment #1 Database Replication (10 points) Due Fri 19 April 2024 v 1.0 Instruction • Database Replication เป็นรูปแบบหนึ่งของ Distributed DBMSs • การทำ replicate ใน assignment นี้เป็นแบบ Master/Slave คือเครื่อง Master จะ เป็นเครื่องหลักในการใช้งาน เมื่อมีการเปลี่ยนแปลงใด ๆ จะทำการทำสำเนา binary log ของการเปลี่ยนแปลงมายัง Slave โดย Slave จะทำการอ่าน binary log แล้ว ทำการเขียนลงฐานข้อมูลใน Slave ทำให้ ข้อมูลใน Master และ Slave จะตรงกัน • ดังนั้นหากมีปัญหาที่เครื่อง Master ผู้ใช้สามารถเปลี่ยน Slave ให้มาทำงานหลัก • นอกจากนี้แล้ว ยังสามารถใช้เครื่อง Slave ในการทำรายงานเพื่อลดการทำงานในฝั่ง ของ Master • Assignment นี้เพื่อให้นักศึกษาได้ลองทำ Database Replication หากมีคำถามหรือ ข้อสงสัย หรือติดปัญหาใด ๆ ให้สอบถาม อ.สนิท Instruction • ใช้ Docker โดยใช้ Image mysql/mysql-server • สร้าง Container 2 ตัวโดยให้ xxx คือรหัสนักศึกษา 3 ตัวท้าย • master-xxx • slave-xxx • ใช้คำสั่งเพื่อทำการ replicate ข้อมูลจาก master มายัง slave • นักศึกษาสามารถกำหนดค่าเพิ่มเติมต่าง ๆ ได้ เช่นที่เก็บไฟล์ข้อมูล ได้เองหรือใช้ค่า default • สร้างฐานข้อมูลเพิ่มเติม สร้างตารางและใส่ข้อมูลในตารางที่สร้างขึ้น • ในแต่ละข้อให้ใส่เลขข้อ และให้ capture หน้าจอคำสั่งและผลลัพธ์แล้ววางในไฟล์ Microsoft Word และ Upload ขึ้น LEB2 ของวิชา INT206 master-xxx 1. ไฟล์ my.cnf ให้เปลี่ยนชื่อเป็น master-xxx.cnf 2. ให้แก้ไข master-xxx.cnf ให้เพิ่ม parameter ดังนี้ Save ไฟล์ master-xxx.cnf 3. ใช้คำสั่งสร้าง container โดยใช้ conﬁg ที่แก้ไข และ กำหนด port ที่ติดต่อกับ host เบอร์ 13306 • แสดงรายละเอียดไฟล์ master-xxx.cnf ให้ชื่อไฟล์ • แสดงคำสร้าง container • แสดงคำสั่งให้เห็นว่า container สามาร run ได้ โดยใช้คำสั่ง docker ps • แสดงคำสั่งเพื่อตรวจสอบ ip ของ master-xxx และให้จด ip (m.m.m.m) ไว้เพื่อกำหนด replication ใน slave-xxx master-xxx 4. ใช้คำสั่ง docker เพื่อจะ import ฐานข้อมูล classicmodels เข้า master-xxx ดังนี้ docker exec -it master-xxx mysql -u root -p < classicmodels.sql กรณีที่ error \"the input device is a not a TTY.\" ให้ทำขั้นตอนนี้ โดยทำการ copy ไฟล์ classicmodels.sql มาไว้ที่ directory ใน container โดยใช้คำสั่ง cp docker cp classicmodels.sql master-xxx:/classicmodels.sql docker exec -it master-xxx bash mysql -u root -p < classicmodels.sql https://stackoverﬂow.com/questions/43099116/error-the-input-device-is-not-a-tty 5. ใช้คำสั่ง docker เพื่อจะใช้โปรแกรม mysql ใน master-xxx • แสดงคำสั่งเพื่อใช้ mysql • แสดงคำสั่งเพื่อแสดงฐานข้อมูลทั้งหมด • แสดงคำสั่งเพื่อแสดงตารางทั้งหมดใน classicmodls slave-xxx 6. ไฟล์ my.cnf ให้เปลี่ยนชื่อเป็น slave-xxx.cnf 7. ให้แก้ไข slave-xxx.cnf ให้เพิ่ม parameter ดังนี้ กำหนด server-id=2 (ไม่ให้ซ้ำกับใน master-xxx) Save ไฟล์ slave-xxx.cnf 8. ใช้คำสั่งสร้าง container โดยใช้ conﬁg ที่แก้ไข และ กำหนด port ที่ติดต่อกับ host เบอร์ 23306 • แสดงรายละเอียดไฟล์ slave-xxx.cnf ให้ชื่อไฟล์ • แสดงคำสร้าง container • แสดงคำสั่งให้เห็นว่า container สามาร run ได้ โดยใช้คำสั่ง docker ps • แสดงคำสั้งเพื่อตรวจสอบ ip ของ slave-xxx และให้จด ip (s.s.s.s) ไว้สำหรับ export ข้อมูลจาก master-xxx ไปยัง slave-xxx slave-xxx 9. ใช้คำสั่งเพื่อใช้โปรแกรม mysql ใน slave-xxx 10. สร้างผู้ใช้ root และระบุ host เป็น % เพื่อให้ผู้ใช้สามารถ connect มาจากที่ไหนก็ได้ 11. กำหนดสิทธิ์ all privileges on *.* แก่ผู้ใช้ 'root'@'%' เพื่อจะ ทำการ import ข้อมูลจาก master-xxx มายัง slave-xxx ในข้อ 19. 12. แสดงคำสั่งเพื่อตรวจสอบสิทธิ์ที่ให้กับ 'root'@'%' master-xxx 13. ใช้คำสั่งเพื่อใช้โปรแกรม mysql ใน master-xxx • แสดงคำสั่ง 14. ใช้คำสั่งสร้าง user ชื่อ slavexxx (xxx คือรหัสนักศึกษา และ s.s.s.s คือ ip ของตัว slave-xxx ส่วน mysql> คือ prompt ของโปรแกรม mysql) ระบุให้ใช้ mysql_native_password และให้สิทธิ์ดังนี้ mysql> create user 'slavexxx'@'s.s.s.s' identiﬁed with mysql_native_password by 'mysql' ; mysql> grant replication slave on *.* to 'slavexxx'@'s.s.s.s' ; mysql> ﬂush privileges ; 15. ใช้คำสั่งเพื่อ lock ตารางก่อนที่จะทำการ backup ข้อมูลเพื่อนำเข้าใน slave-xxx mysql> ﬂush tables with read lock ; mysql> show master status ; 16. แสดงคำสั่งและผลลัพธ์ ให้จด master_log_ﬁle และ master_log_pos เพื่อกำหนดค่าใน slave-xxx master-xxx 17. ใช้คำสั่งเพื่อเข้า bash shell ของ master-xxx (# คือ prompt ของ bash shell) ทำการ export all databases และบันทึกไว้ในไฟล์ data.sql # mysqldump -u root -p -h localhost --all-databases > data.sql 18. ใช้คำสั่งเพื่อใช้โปรแกรม mysql ใน master-xxx เพื่อปลดล็อคตารางที่ได้ทำการล็อค ไว้ในข้อ 15 (read lock) mysql> unlock tables ; 19. ทำการ import data.sql ไปยัง slave-xxx ระบุ ip ของ slave ใน -h s.s.s.s โดยเข้า bash shell ใน master-xxx ดังนี้ (ถ้า error 1130 (HY000): Host x.x.x.x is not allowed to connect to this MySQL server. แสดงว่ายังไม่ได้ทำข้อ 10-11) # mysql -u root -p -h s.s.s.s < data.sql slave-xxx 20. ใช้คำสั่ง docker เพื่อจะใช้โปรแกรม mysql ใน slave-xxx 21. ทำการหยุดการทำงานของ slave mysql> stop slave ; 22. ตั้งค่า replication โดยกำหนดรายละเอียดของ master ดังนี้ (แทน xxxxxx และ yyyy จากข้อ 16) mysql> change master to master_host = 'm.m.m.m', master_user = 'slavexxx', master_password = 'mysql', master_log_ﬁle = 'mysql-bin.xxxxxx', master_log_pos = yyyy ; 23. ทำการเริ่มการทำงานของ slave-xxx mysql> start slave; 24. แสดงสถานะการทำงานของ slave mysql> show slave status \\G show slave status \\G • ถ้าการทำงานของ replication ทำงานได้ จะขึ้นข้อความ Slave_IO_State: Waiting for source to send event • แต่ถ้าขึ้นข้อความ Reconnecting แสดงว่ายังไม่สามารถทำงานได้ Slave_IO_State: Reconnecting after a failed source event read • ให้ตรวจสอบ Last_IO_Errorno และ Last_IO_Error ว่าเกิด error อะไร (กรณีไม่มี Error จะขึ้น Last_IO_Errnono: 0) master-xxx 25. ใช้คำสั่ง docker เพื่อจะใช้โปรแกรม mysql ใน master-xxx • สร้างฐานข้อมูลใหม่ชื่อ dbXXX (xxx คือรหัสนักศึกษา 3 ตัวท้าย) • สร้างตาราง 1 ตารางใน dbXXX ให้ระบุ XXX ท้ายชื่อตารางและ ใส่ข้อมูลเข้าในตารางที่สร้างขึ้น • แสดงข้อมูลในตารางที่สร้างขึ้น • แสดงสถานะของ replication ของ master ใช้คำสั่ง show master status ; slave-xxx 26. ใช้คำสั่ง docker เพื่อจะใช้โปรแกรม mysql ใน slave-xxx • แสดงฐานข้อมูลทั้งหมด • ใช้ฐานข้อมูล dbXXX ที่สร้างใน master-xxx • ใช้คำสั่งเพื่อแสดงข้อมูลในตารางที่สร้างใน dbXXX • ใช้คำสั่งแสดงสถานะ replication ของ slave โดยใช้คำสั่ง show slave status \\G References • https://dev.mysql.com/doc/refman/8.0/en/replication.html • https://developpaper.com/master-slave-replication-of- mysql-based-on-docker/ • https://sesamedisk.com/docker-mysql-master-slave- replication-with-docker/ ปัญหาที่พบบ่อย 1. ไม่กำหนด server-id ในข้อ 2 ทำให้ server-id เป็น 1 ทั้ง master และ slave 2. เกิด Error ไม่สามารถ connect ไปยัง host ได้ \"Slave_IO_State: Reconnecting after a failed source event read\" ให้อ่าน Last_IO_Error ว่าแจ้ง error อะไร","libVersion":"0.3.1","langs":""}