{"path":"Lecture Kmutt/INT204/materials/05-INT204-Spring-boot-JPAQuery-with-PaginationAndSorting.pdf","text":"Sp ri n g R E S T f u l A P I Pa g i n a t i o n & So rt i n g By Pi ch e t L i m v a j i r a n a n Sp ri n g D a t a R E S T : P a g i n a t i o n a n d So rt i n g • Th e P a g i n g A n d S o rt i n g R e p o s i t o r y is an e x t e n s io n o f C ru d R e p o s i t o r y to p r o v i d e a d d i t i o n a l m e t h o d s t o r e t ri e v e e n t i t i e s u s i n g t h e p a g i n a t i o n a n d s o rt i n g ab s t r ac t io n . I t im p lic it ly p r o v id e s t w o m e t h o d s : • Pa g e < T > fi n d A l l (P a g e a bl e pa g e a bl e ) r e t ur ns a P a g e o f e n t i t i e s m e e t i ng t he pa g i ng r e s t r i c t i o n pr o v i de d i n t he P a g e a bl e o bj e c t . Pageable firstPageTwoElements = PageRequest.of ( 0 , 2 ); Pageable secondPageFiveElements = PageRequest.of ( 1 , 5 ); • It e r a b l e <T > fi n d A l l (S o r t s o r t ) r e t ur ns a l l e n t i t i e s s o r t e d b y t he g i v e n o p t i o ns . N o pa g i ng i s a ppl i e d he r e . Sort sortedByName = Sort.by ( \"name\" ); • P a g i n a t i o n & S o rt i n g Pageable sortedByPriceDescNameAsc = PageRequest.of ( 0 , 5 , Sort.by ( \"price\" ).descending().and( Sort.by ( \"name\" ))); Sp ri n g D a t a So rt a n d O r d e r • T h e S o rt c l a s s p r o v i d e s s o rt i n g o p t i o n s f o r d a t a b a s e q u e ri e s w i t h m o r e f l e x i b i l i t y i n c h o o s i n g s i n g l e / m u l t i p l e s o rt c o l u m n s a n d d i r e c t i o n s ( a s c e n d i n g / d e s c e n d i n g ) . • w e us e b y ( ) , de s c e ndi ng ( ) , a nd( ) m e t ho ds t o c r e a t e S o r t o bj e c t a nd pa s s i t t o R e po s i t o r y . f i ndA l l () • Y o u c a n s o rt r e s u l t s b y S o rt a n d O r d e r o b j e c t w i t h o n e o r m o r e s p e c i f i e d v a ri a b l e s . • S o rt i n g c a n b e d o n e i n a s c e n d i n g o r d e s c e n d i n g o r d e r . @S er v i c e : : publ i c Li s t < Cu s t o m er > ge t A l l C u s t o m e r s ( St r i n g so rtB y ) { re t u r n re p o s i t o r y .f i n d A l l ( So r t . Di r e c t i o n . DE S C , So r t . by ( so rtB y )); } S o r t & O r d e r o b j e ct e x a m p l e // order by 'published' column - ascending List < Tutorial > tutorials = tutorialRepository . findAll ( Sort . by ( \"published\" )); // order by 'published' column, descending tutorialRepository . findAll ( Sort . by ( \"published\" ). descending ()); // order by 'published' column - descending, then order by 'title' - ascending tutorialRepository . findAll ( Sort . by ( \"published\" ). descending (). and ( Sort . by ( \"title\" ))); List < Sort.Order > orders = new ArrayList (); Sort.Order order1 = new Sort.Order ( Sort . Direction . DESC , \"published\" ); orders . add ( order1 ); Sort.Order order2 = new Sort.Order ( Sort . Direction . ASC , \"title\" ); orders . add ( order2 ); List < Tutorial > tutorials = tutorialRepository . findAll ( Sort . by ( orders )); E x e r ci s e 1 : • Cr e a t e R E S T A P I s e r v i c e f o r P r o d u c t s a s e n d - po i n t s be l o w URI H T T P v e rb D e s c ri p t i o n / pr o duc t s GE T G e t a l l pr o duc t s f i l t e r b y pr i c e be t w e e n a nd pr o duc t na m e c o n t a i ns s o r t i ng a s r e que s t s pe c i f y publ i c i n t e r f a c e Pr o d u c t R e p o s i t o r y ex t e n d s Jp aR e p os it or y < Pr o d u c t , St r i n g > { Li s t < Pr o d u c t > ge t P r o d u c t s B y P r i c e B e t w e e n A n d P r o d u c t N a m e C o n t a i n s ( Do ubl e l o w e r , Do ubl e u p p e r , St r i n g pa r t O f N a m e , So r t so rt) ; Pr o d u c t fin d F ir s t B y O r d e r B y P r ice D e s c (); } @S er v i c e publ i c c l a s s Pr o d u c t S e r v i c e { @ Au t o w i r e d Pr o d u c t R e p o s i t o r y re p o s i t o r y ; publ i c Li s t < Pr o d u c t > ge t A l l P r o d u c t s ( Do ubl e l o w e r , Do ubl e uppe r , St r i n g pa r t O f N a m e , St r i n g so rtB y , St r i n g di r e c t i o n) { if (uppe r = = 0 && l o w e r= = 0 ) { uppe r = re p o s i t o r y .f i n d F i r s t B y O r d e r B y P r i c e D e s c (). ge t P r i c e (); } if ( so rtB y .i sEm pty ()) { so rtB y = \" pr o duc t C o de \" ; } So r t . Or d e r so rtOr d e r = ne w So r t .O r d e r (( di r e c t i o n. e qua l s I g no r e C a s e ( \" as c \" )? So r t . Di r e c t i o n . AS C : So r t . Di r e c t i o n . DE S C ) , so rtB y ); re t u r n re p o s i t o r y .g e t P r o d u c t s B y P r i c e B e t w e e n A n d P r o d u c t N a m e C o n t a i n s ( lo w e r , u p p e r , pa r t O f N a m e , So r t . by ( so rtOr d e r )); } } @ Re s t C o n t r o l l e r @ Re q u e s t M a p p i n g ( \"/ p r o d u c t s \" ) publ i c c l a s s Pr o d u c t C o n t r o l l e r { @ Au t o w i r e d Pr o d u c t S e r v i c e se r v i c e ; @ Ge t M a p p i n g ( \"\" ) publ i c Li s t < Pr o d u c t > ge t A l l P r o d u c t s ( @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"\" ) St r i n g pa r t O f P r o duc t N a m e , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"0 \" ) Do ubl e lo w e r , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"0 \" ) Do ubl e uppe r , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"\" ) St r i n g so rtB y , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"A S C\" ) St r i n g so rtD i r e c ti o n ) { re t u r n se r v i c e .g e t A l l P r o d u c t s ( l o w e r , u p p e r , pa r t O f P r o duc t N a m e , so rtB y , so rtD i r e c ti o n ); } } Jp a R ep o s i t o r y wit h P ag in a t ion • fin d A ll (P a g e a b l e p a g e a b l e ): r e t u r n s a P a g e o f e n t i t i e s m e e t i n g t h e pa g i ng c o ndi t i o n pr o v i de d b y P a g e a bl e o bje c t . • Pa g i n a t i o n c a n b e a d d e d b y c r e a t i o n o f Pa g e R e q u e s t ob j e c t wh i c h i s im p le m e n t a t io n o f P ag e ab le in t e r f ac e . • Si m i l a r t o so r t i ng a ddi ng pa g i na t i o n de pe nds fr o m ty p e of R e p os i t or y ex t e n d e d b y o u r i n t e r f a c e . @S e r v i c e : publ i c Pa g e < C u s t o m e r > g e t A l l C us t o m e r s ( in t pa g e , in t pa g e S i z e ) { P a g e a bl e pa g e a bl e = Pa g e R e q u e s t . of ( pa g e , pa g e S i z e ); r e t ur n r e po s i t o r y . f i ndA l l ( pa g e a bl e ) ; } Ac c ep t i n g P a g e a n d S or t P a r a m e t er s • G e n e r a l l y , p a g i n g a n d s o r t i n g p a r a m e t e r s a r e o p t i o n a l a n d t h u s p a r t o f t h e r e q u e s t U R L a s q u e r y p a r a m e t e r s . I f a n y A P I s u p p o r t s p a g i n g a n d s o r t i n g , A L W A Y S p r o v i d e d e f a u l t v a l u e s t o t h e s e p a r a m e t e r s – to b e u s e d w h e n t h e c l i e n t d o e s n o t c h o o s e t o s p e c i f y a n y p a g i n g o r s o r t i n g p r e f e r e n c e s . • Ex a m p l e : @ Ge tMa p p i n g ( \"\" ) public Lis t < Cu s t o m e r > ge t A l l C u s t o m e r s ( @ Re q u e st P a r a m ( de f ault V alue = \"i d \" ) St r ing so r t B y , @ Re q u e st P a r a m ( de f ault V alue = \"0 \" ) In t e g e r pag e , @ Re q u e st P a r a m ( de f ault V alue = \"1 0 \" ) In t e g e r pag e Siz e ) { Pa g e < C u s t o m e r > c u s t o m e r s = se r v i c e .f i n d A l l ( so r t B y , p a g e , pag e Siz e ); re t u r n cu s t o m e r s . ge t C o n t e nt (); } P a g e < T > O b j e ct { \"c o n t e n t \": [ { \" i d\" : 323, \" c us t o m e r N a m e \": \"D o w n U nde r S o uv e ni e r s , I nc \" , \" co n t a c t L a s t N a m e \": \" G r a ha m \" , \" co n t a c t F i r s t N a m e \": \"M i k e \", \" pho ne \" : \"+ 6 4 9 312 5555\" , \" a ddr e s s L i ne 1 \" : \"1 6 2 - 164 Gr a f t o n R o a d\" , \" a ddr e s s L i ne 2 \" : \"L e v e l 2\" , : ] \" pa g e a bl e \" : { \"s o r t \": { \"e m p t y \": fa l s e , \" s o r t e d\" : tru e , \" uns o r t e d\" : fa l s e }, \"o f f s e t \": 5, \" pa g eS i z e \": 5, \" pa g eN um ber \": 1, \"u n p a g e d \": fa l s e , \"p a g e d \": tr u e }, \"l a s t \": fa l s e , \" to t a l P a g e s \": 25, \" to t a l E l e m e n t s \": 122, \"s i z e \": 5, \"n u m b e r \": 1, \"s o r t \": { \"e m p t y \": fa l s e , \"s o r t e d \": tr u e , \"u n s o r t e d \": fa l s e }, \" num ber O f E l em en t s \": 5, \"f i r s t \": fa l s e , \"e m p t y \": fa l s e } S e r v i ce - Pa g i n g & S o r t i n g @S e r v i c e publ i c c l a s s C us t o m e r S e r v i c e { @ A ut o w i r e d pr i v a t e C us t o m e r R e po s i t o r y r e po s i t o r y ; publ i c Pa g e < C us t o m e r > g e t A l l C us t o m e r s ( S t r i ng so r tB y , in t pa g e , in t pa g e S i z e ) { P a g e a bl e pa g e bl e = P a g e R e que s t . of ( pa g e , pa g e S i z e ); P a g e < C us t o m e r > c us t o m e r s = r e po s i t o r y . f i ndA l l ( pa g e bl e ); r e t ur n c us t o m e r s ; } } { \"c o n t e n t \" : { { }, { }, { } } , \"p a g e \" : { \"s i z e \" : 20 , \" to t a l E l e m e n t s \" : 11 , \" to t a l P a g e s \" : 1 , \"n u m b e r \" : 0 } } Co n tr o l l er - Pa g i n g & S o r t i n g @ Re s t C o n t r o l l e r @ R e que s t M a ppi ng ( \"/ a pi / c us t o m e r s \" ) publ i c c l a s s C us t o m e r C o n t r o l l e r { @ A ut o w i r e d pr i v a t e C us t o m e r S e r v i c e se r v i c e ; @ G e t M a ppi ng ( \"\" ) publ i c Li s t < C us t o m e r > g e t A l l C us t o m e r s ( @ R e que s t P a r a m ( de f a ul t V a l ue = \" i d\" ) S t r i ng so r tB y , @ R e que s t P a r a m ( de f a ul t V a l ue = \"0\" ) In t e g e r pa g e , @ R e que s t P a r a m ( de f a ul t V a l ue = \"10\" ) In t e g e r pa g e S i z e ) { r e t ur n se r v i c e . f i ndA l l ( so r tB y , pa g e , pa g e S i z e ). ge t C o n t e n t () ; } } l oc a l h os t : p or t / a p i / cu s t om e r s ? s or t B y = i d & p a g e = 0 & p a g e S i z e = 1 0 Co n t r o lle r Bu s i n e s s L o g i c ( Se r vi c e C l a s s ) Pe r s i s t e n c e ( Re p o s i t o r y C l a s s ) Pr e s e n t a t io n En t it y En t it y JS O N E x e r ci s e 2: • Cr e a t e R E S T A P I s e r v i c e f o r P r o d u c t s a s e n d - po i n t s be l o w URI H T T P v e rb D e s c ri p t i o n / pr o duc t s GE T G e t a l l pr o duc t s f i l t e r b y pr i c e be t w e e n a nd pr o duc t na m e c o n t a i ns s o r t i ng a s r e que s t s pe c i f y w i t h pa g i na t i o n publ i c i n t e r f a c e Pr o d u c t R e p o s i t o r y ex t e n d s Jp aR e p os it or y < Pr o d u c t , St r i n g > { Li s t < Pr o d u c t > ge t P r o d u c t s B y P r i c e B e t w e e n A n d P r o d u c t N a m e C o n t a i n s ( Do ubl e l o w e r , Do ubl e u p p e r , St r i n g pa r t O f N a m e , So r t so rt) ; Pr o d u c t fin d F ir s t B y O r d e r B y P r ice D e s c (); Pa g e < Pr o d u c t > ge t P r o d u c t s B y P r i c e B e t w e e n A n d P r o d u c t N a m e C o n t a i n s ( Do u b l e lo w er , Do u b l e uppe r , St ri n g pa r t Of N a m e , Pa g e a b l e pa g e a bl e ) ; } Ad d N ew Q u e r y M e t h o d t o su p p o rt pa g i na t i o nOv e rl o a d se r v i c e m e t h o d t o su p p o rt pa g i na t i o n publ i c Pa g e < Pr o d u c t > ge t A l l P r o d u c t s ( Do ubl e l o w e r , Do ubl e uppe r , St r i n g pa r t O f N a m e , St r i n g so rtB y , St r i n g di r e c t i o n, in t pa g e N o , in t pa g e S i z e ) { if (uppe r = = 0 && l o w e r = = 0 ) { uppe r = re p o s i t o r y .f i n d F i r s t B y O r d e r B y P r i c e D e s c (). ge t P r i c e (); } if ( so rtB y .i sEm pty ()) { so rtB y = \" pr o duc t C o de \" ; } So r t . Or d e r so rtOr d e r = ne w So r t .O r d e r ( ( di r e c t i o n. e qua l s I g no r e C a s e ( \" as c \" ) ? So r t . Di r e c t i o n . AS C : So r t . Di r e c t i o n . DE S C ) , so rtB y ); Pa g e a b l e p a g e a b l e = Pa g e R e q u e s t . of ( pa g e N o , pa g e S i z e , So r t . by ( so rtOr d e r )); re t u r n re p o s i t o r y .g e t P r o d u c t s B y P r i c e B e t w e e n A n d P r o d u c t N a m e C o n t a i n s ( l o w e r , u p p e r , pa r t O f N a m e , pa g e a bl e ); } C on t r ol l e r : C r e a t e n e w e n d - po i n t /M o di f y m e t ho d to s u p p o r t p a g i n a t i o n @ Re s t C o n t r o l l e r @ Re q u e s t M a p p i n g ( \"/ p r o d u c t s \" ) publ i c c l a s s Pr o d u c t C o n t r o l l e r { @ Au t o w i r e d Pr o d u c t S e r v i c e se r v i c e ; @ Ge t M a p p i n g ( \"\" ) publ i c Pa g e < Pr o d u c t > ge t A l l P r o d u c t s ( @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"\" ) St r i n g pa r t O f P r o duc t N a m e , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"0 \" ) Do ubl e lo w e r , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"0 \" ) Do ubl e uppe r , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"\" ) St r i n g so rtB y , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"A S C\" ) St r i n g so rtD i r e c ti o n , @ Re q u e s t P a r a m ( de f a ul t V a l ue = ”0 \" ) in t pa g e N o , @ Re q u e s t P a r a m ( de f a ul t V a l ue = \"1 0 \" ) in t pa g e S i z e ) { re t u r n se r v i c e .g e t A l l P r o d u c t s ( l o w e r , u p p e r , pa r t O f P r o duc t N a m e , so rtB y , so rtD i r e c ti o n , pa g e N o , pa g e S i z e ); } }","libVersion":"0.3.1","langs":""}