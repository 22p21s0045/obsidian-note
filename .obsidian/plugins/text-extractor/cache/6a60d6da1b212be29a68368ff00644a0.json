{"path":"Lecture Kmutt/INT209/2023-INT209-03 Build Docker Images v0.9.1.pdf","text":"INT 2 0 9 D ev O p s LA B - 03 B uild D o c k e r I m a g e s Ol a r n R o j a n a po r n pu n Th u rs d ay , 25 A p r il 2024 http s:/ / d o c s.d o c k e r .c o m / b u ild / http s:/ / d o c s.d o c k e r .c o m / b u ild / g u id e / http s:/ / d o c s.d o c k e r .c o m / r e f e r e nc e / d o c k e r f ile / IN T 2 0 9 De v Op s D o c k er B u ild a r c h it ec t u r e ❍ B u ild x is t h e c lien t a n d t h e u s er in t er f a c e f o r r u n n in g a n d m a n a g in g b u ild s ❍ B u ild K it is t h e s er v er , o r b u ild er , t h a t h a n d les t h e b u ild ex ec u t io n . 2 ht t p s : / / d oc s . d oc k e r . c om / b u ild / a r c hit e c t u r e / IN T 2 0 9 De v Op s build co mma n d ❍ T h e d o c k er build c o m m a n d b u ild s D o c k er im a g es f r o m a D o c k er f ile an d a \" c o n t ex t \" ❍ A b u ild ’ s c o n t ex t is t h e s et o f f iles lo c a t ed in t h e s p ec if ied P A T H o r U R L ❍ T h e U R L p a r a m et er c a n r ef er t o t h r ee k in d s o f r es o u r c es : G it r ep o s it o r ies , p r e - p a c k a g ed t a r b a ll c o n t ex t s , a n d p la in t ex t f iles ❍ B y d ef a u lt , t h e d o c k er b u ild c o m m a n d lo o k s f o r a D o c k er f ile a t t h e r o o t o f t h e b u ild c o n t ex t ❍ T h e - f , -- file , o p t io n let s y o u s p ec if y t h e p a t h t o a n a lt er n a t iv e f ile t o u s e in s t ea d ❍ R ela t iv e p a t h a r e in t er p r et ed a s r ela t iv e t o t h e r o o t o f t h e c o n t ex t 3 # build the image using Dockerfile in current directory and tag the image with ‘hello’ docker build -t hello . # use the file FE.Dockerfile in FrontEnd directory instead docker build -f FE.Dockerfile FrontEnd ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /im a g e /b u ild / docker image build [OPTIONS] PATH | URL | - IN T 2 0 9 De v Op s D o c k er f ile ❍ D o c k er b u ild s im a g es b y r ea d in g t h e in s t r u c t io n s f r o m a D o c k er f ile ❍ T h e d ef a u lt f ilen a m e t o u s e f o r a D o c k er f ile is D o c k er f ile , w it h o u t a f ile ex t en s io n ❍ T h e in s t r u c t io n n a m e is n o t c a s e - s en s it iv e, b u t is C A P I T A L b y c o n v en t io n 4 FROM node:14.14.0-alpine3.12 COPY . /nodejs/. WORKDIR /nodejs RUN npm install ENV VERSION 1.0 EXPOSE 8081 CMD [\"node\", \"/nodejs/main.js\"] S am p le D o c k e r f ile IN T 2 0 9 De v Op s FROM in s t r u c t io n ❍ T h e FROM in s t r u c t io n in it ia lizes a n ew b u ild s t a g e a n d s et s t h e b a s e im a g e f o r s u b s eq u en t in s t r u c t io n s ❍ A v a lid D o c k er f ile m u s t s t a r t w it h a FROM in s t r u c t io n ❍ ARG is t h e o n ly in s t r u c t io n t h a t m a y p r ec ed e FROM in t h e D o c k er f ile 5 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e / do c k e rf ile /# f r o m FROM [--platform=<platform>] <image>[:<tag>] [AS <name>] IN T 2 0 9 De v Op s FORMS ❍ T h e RUN , CMD , an d ENTRYPOINT in s t r u c t io n s a ll h a v e t w o p o s s ib le f o r m s : 6 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e / do c k e rf ile /# s h e ll - an d - exec - fo r m INSTRUCTION [\"executable\",\"param1\",\"param2\"] (exec form) INSTRUCTION command param1 param2 (shell form) ❍ T h e ex ec f o r m c a n b e u s ed t o in v o k e c o m m a n d s u s in g a s p ec if ic c o m m a n d s h ell, o r a n y o t h er ex ec u t a b le. I t u s es a J S O N a r r a y s y n t a x , w h er e ea c h elem en t in t h e a r r a y is a c o m m a n d , f la g , o r a r g u m en t ( u s es d o u b le - q u o t es ) . I t is b es t u s ed t o s p ec if y a n ENTRYPOINT in s t r u c t io n . ❍ T h e s h ell f o r m is m o r e r ela x ed , a n d em p h a s izes ea s e o f u s e, f lex ib ilit y , a n d r ea d a b ilit y . T h e s h ell f o r m a u t o m a t ic a lly u s es a c o m m a n d s h ell, w h er ea s t h e ex ec f o r m d o es n o t . ENTRYPOINT [\"/bin/bash\", \"-c\", \"echo hello\"] RUN source $HOME/.bashrc && \\ echo $HOME IN T 2 0 9 De v Op s RU N in s t r u c t io n ❍ T h e RUN in s t r u c t io n w ill ex ec u t e a n y c o m m a n d s t o c r ea t e a n ew la y er o n t o p o f t h e c u r r en t im a g e ❍ T h e s h ell f o r m is m o s t c o m m o n ly u s ed 7 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e / do c k e rf ile /# r u n RUN <<EOF apt-get update apt-get install -y curl EOF # Shell form: RUN [OPTIONS] <command> ... # Exec form: RUN [OPTIONS] [ \"<command>\", ... ] ❍ T h e a v a ila b le [OPTIONS] f o r t h e RUN in s t r u c t io n a r e: -- mount , -- network , -- security IN T 2 0 9 De v Op s CMD in s t r u c t io n ❍ T h e CMD in s t r u c t io n s et s t h e c o m m a n d t o b e ex ec u t ed w h en r u n n in g a c o n t a in er f r o m a n im a g e ❍ T h er e c a n o n ly b e o n e CMD in s t r u c t io n in a D o c k er f ile . I f y o u lis t m o r e t h a n o n e CMD , o n ly t h e la s t o n e t a k es ef f ec t ❍ CMD d o es n ’ t ex ec u t e a n y t h in g a t b u ild t im e, b u t s p ec if ies t h e in t en d ed c o m m a n d f o r t h e im a g e ❍ T h e p u r p o s e o f a CMD is t o p r o v id e d ef a u lt s f o r a n ex ec u t in g c o n t a in er . T h es e d ef a u lt s c a n in c lu d e a n ex ec u t a b le, o r t h ey c a n o m it t h e ex ec u t a b le, in w h ic h c a s e y o u m u s t s p ec if y a n ENTRYPOINT in s t r u c t io n a s w ell. ❍ If CMD is u s ed t o p r o v id e d ef a u lt a r g u m en t s f o r t h e ENTRYPOINT in s t r u c t io n , b o t h t h e CMD an d ENTRYPOINT in s t r u c t io n s s h o u ld b e s p ec if ied in t h e ex ec f o r m . 8 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e / do c k e rf ile /# cm d CMD [\"executable\",\"param1\",\"param2\"] # exec form # (exec form, as default parameters to ENTRYPOINT) CMD [\"param1\",\"param2\"] CMD command param1 param2 # shell form IN T 2 0 9 De v Op s ENTRYPOINT in s t r u c t io n ❍ An ENTRYPOINT a llo w s y o u t o c o n f ig u r e a c o n t a in er t h a t w ill r u n a s a n ex ec u t a b le ❍ C o m m a n d lin e a r g u m en t s t o docker run <image> w ill b e a p p en d ed a f t er a ll elem en t s in a n ex ec f o r m ENTRYPOINT , a n d w ill o v er r id e a ll elem en t s s p ec if ied u s in g CMD 9 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e / do c k e rf ile /# en t r y p o in t ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e / do c k e rf ile /# u n d e r s ta n d - how - cm d - an d - en t r y p o in t - in t e r a ct CMD [\"executable\",\"param1\",\"param2\"] # exec form # (exec form, as default parameters to ENTRYPOINT) CMD [\"param1\",\"param2\"] CMD command param1 param2 # shell form IN T 2 0 9 De v Op s E x er c is e 1 10 1. Bu ild ‘ 209la b 3: ex 1 - 1 ’ im a g e b a s e d o n op en j d k : 1 7 - jd k - alp ine . Co nf ig u r e the imag e to r u n sh as d e f au lt . 2. Bu ild ‘ 209la b 3: e x 1 - 2 ’ im a g e b a s e d o n b u s y b o x . Co nf ig u r e the imag e to e xe c u te echo hello world wh e n r u n the c o ntaine r . Allo w d if f e r e nt s tr ing to b e d is p lay . IN T 2 0 9 De v Op s COPY in s t r u c t io n ❍ T h e COPY in s t r u c t io n c o p ies n ew f iles o r d ir ec t o r ies f r o m < src > a n d a d d s t h em t o t h e f iles y s t em o f t h e c o n t a in er a t t h e p a t h < dest > . ❍ M u lt ip le < src > r es o u r c es m a y b e s p ec if ied b u t t h e p a t h s o f f iles a n d d ir ec t o r ies w ill b e in t er p r et ed a s r ela t iv e t o t h e s o u r c e o f t h e c o n t ex t o f t h e b u ild . ❍ Ea c h < src > m a y c o n t a in w ild c a r d s ❍ T h e < dest > is a n a b s o lu t e p a t h , o r a p a t h r ela t iv e t o WORKDIR , in t o w h ic h t h e s o u r c e w ill b e c o p ied in s id e t h e d es t in a t io n c o n t a in er . 11 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e / do c k e rf ile /# c o p y COPY [OPTIONS] <src> ... <dest> COPY [OPTIONS] [\"<src>\", ... \"<dest>\"] ❍ T h e a v a ila b le [OPTIONS] f o r t h e RUN in s t r u c t io n a r e: -- from, -- chown , -- chmod , -- link, -- parents, -- exclude ❍ COPY h a s t w o f o r m s . T h e la t t er f o r m is r eq u ir ed f o r p a t h s c o n t a in in g w h it es p a c e. IN T 2 0 9 De v Op s COPY in s t r u c t io n 12 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e / do c k e rf ile /# c o p y IN T 2 0 9 De v Op s E x er c is e 2 13 1. Bu ild ‘ da t e a p i: v 1 ’ im a g e b a s e d o n op en j d k : 1 7 - jd k - alp ine . Co p y . j ar f ile and c o nf ig u r e the imag e to r u n the j ar f ile . Allo w the po r t t o be s pe c if ie d d u r in g r u n 2. Bu ild ‘ fe t ch d a t e : v1 ’ im a g e b a s e d o n ng inx:alp ine . Co p y d is t/ to the imag e ( r e p lac e d e f au lt html)","libVersion":"0.3.1","langs":""}