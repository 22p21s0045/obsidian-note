{"path":"Lecture Kmutt/INT210-LAB/materials/2023-INT209-02 Docker CLI Basics v0.9.5.pdf","text":"INT 2 0 9 D ev O p s LA B - 02 Do ck er C L I Ba s ics Ol a r n R o j a n a po r n pu n Th u rs d ay , 2 1 Marc h 2 0 2 4 IN T 2 0 9 De v Op s D o c k er C h ea t S h eet ❍ http s :/ / d o c s .d o c k e r .c o m/ g e t - s t a r t e d / d o c k e r _c h e a t s h e e t . p d f 2 IN T 2 0 9 De v Op s run co mma n d : pr im a r y pr oce s s , -- name : cr e a t e a n d r u n a n e w co n t a in e r fr o m a n im a ge ❍ Ru n s a co m m a n d in a n ew c o n t a in er a s p r im a r y p r o c es s (P I D 1 ) ❍ I f a c o m m a n d is n o t g iv en , r u n s a c o m m a n d s p ec if ied in t h e im a g e ❍ W h en t h e p r im a r y p r o c es s is t er m in a t ed , t h e c o n t a in er is ex it ed 3 # Run Nginx in background and set the container name to ‘ngx1’ docker run --name ngx1 -d nginx:alpine docker exec ngx1 ps -ef PID USER TIME COMMAND 1 root 0:00 nginx: master process nginx -g daemon off; 30 nginx 0:00 nginx: worker process 31 nginx 0:00 nginx: worker process 32 root 0:00 ps -ef # Run echo command in foreground and the container is exited docker run --name ngx2 nginx:alpine echo hello world hello world # List the last created container docker ps -n 1 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 23184390068f nginx:alpine \"/docker-entrypoint.…\" 1 second ago Exited (0) Less than a second ago ngx2 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /r u n / docker container run [OPTIONS] IMAGE [COMMAND] [ARG...] IN T 2 0 9 De v Op s run co mma n d : - it ; -- rm; - d ❍ I f t h e p r im a r y p r o c es s is in t er a c t iv e , t h e o p t io n - it m u s t b e u s ed , o t h er w is e t h e p r o c es s is t er m in a t ed 4 # Run busybox without -it option docker run busybox docker ps -n 1 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 50ce2d947c0a busybox \"sh\" 24 seconds ago Exited (0) 24 seconds ago elegant_carver # Run busybox image with -it option docker run --name bbx1 -it busybox / # exit # Run ps command and remove the container afterward docker run --rm busybox ps -ef PID USER TIME COMMAND 1 root 0:00 ps -ef docker ps -n 1 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 44c62638c8cf busybox \"sh\" 18 seconds ago Exited (0) 15 seconds ago bbx1 # Run echo command in background, the text is shown in ‘logs’ instead docker run --name bbx2 -d busybox echo hello world docker logs bbx2 hello world ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /r u n / IN T 2 0 9 De v Op s run co mma n d : publis h por t ❍ T h is b in d s p o r t 8 0 o f t h e c o n t a in er t o T C P p o r t 8 0 o n 1 2 7 . 0 . 0 . 1 o f t h e h o s t ❍ I f I P is n o t s p ec if ied , it b in d s t o a ll in t er f a c es ( 0 . 0 . 0 . 0 ) ❍ D o c k er m a n a g es it s o w n ip t a b les r u les ( o v er r id e f ir ew a ll s et t in g ) 5 # Bind port 80 on container to port 3000 on host docker run -d -p 3000:80 nginx:alpine # Bind all exposed ports on container to random ports on host docker run --name ngx3 -d -P nginx:alpine docker ps -n 1 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 9552eb2f6aa7 nginx:alpine \"/docker-entrypoint.…\" 48 seconds ago Up 47 seconds 0.0.0.0:32768->80/tcp, ngx3 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /r u n /# p u b lis h docker run -p 127.0.0.1:80:80 nginx:alpine IN T 2 0 9 De v Op s run co mma n d : restart an d env 6 # Restart the container when daemon startup docker run –name ngx4 -d --restart unless-stopped nginx:alpine docker inspect --format='{{.HostConfig.RestartPolicy.Name}}' ngx4 unless-stopped sudo systemctl restart docker docker ps -n 1 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 15be737b9adc nginx:alpine \"/docker-entrypoint.…\" 39 seconds ago Up 2 seconds 80/tcp ngx4 # Update restart policy on existing container docker update --restart no ngx4 docker inspect --format='{{.HostConfig.RestartPolicy.Name}}' ngx4 no # Set environment variables in the container. Can use variables exported in host. # can use -e or --env export firstname=Jack docker run --rm -e firstname --env lastname busybox env | grep name firstname=Jack # The argument override the host variable export firstname=Jack docker run --rm -e firstname=Tim --env lastname=Russell busybox env | grep name firstname=Tim lastname=Russell ca n us e T A B t o f i n d a v a i l a b l e r e s t a r t p ol i cy ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /r u n /# r e s ta r t th e c o n tai n e r m ay r e s tar t i n d e f i n i te l y , l e ad s to h i g h C P U u s ag e ! IN T 2 0 9 De v Op s ps co mma n d : lis t c o n t a in e r s ❍ a lia s o f docker container ls ❍ - a , -- a ll s h o w a ll c o n t a in er s ( d ef a u lt s h o w s j u s t r u n n in g ) ❍ - f , -- f ilt er f ilt er o u t p u t b a s ed o n c o n d it io n s p r o v id ed e. g . { n a m e, s t a t u s , a n c es t o r , p u b lis h , ex p o s e} ❍ - q , -- q u iet d is p la y c o n t a in er I D s o n ly 7 # List all containers with the name ‘busybox’ docker ps -a --filter name=busybox # List all containers with the image ‘ubuntu’ or has it as base docker ps --filter ancestor=ubuntu # List all containers that expose port 80 docker ps -f expose=80 # List all containers that publish port 80 docker ps -f publish=80 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /ls / ca n us e T A B t o f i n d a v a i l a b l e key an d va l u e wi th e x p o s e an d p u b l i s h , o n l y ru n n i n g an d pa u s e d con t a i n e r s a r e l i s t e d IN T 2 0 9 De v Op s ps co mma n d Ex e r c is e s 1. Lis t a lll e x it e d c on t a in e rs 2. Delet e a ll ex it ed c o n t a in ers in o n e c o m m a n d [ h in t : u s e ‘ $ ( )’ ] 8 IN T 2 0 9 De v Op s exec co mma n d : ex ec ut e a c om m a n d in a run n in g c on t a in er ❍ n eed - it w h en ex ec u t e in t er a c t iv e c o m m a n d ❍ m a y u s e sh - c t o ex ec u t e c h a in ed c o m m a n d s ❍ m a y u s e - d - e as run 9 # Run busybox in background with the name ‘bbx3’ docker run --name bbx3 -it -d busybox # Execute ‘cat’ in bbx3 container. Without -it, cat process is terminated immediately. docker exec bbx3 cat # Execute ‘cat’ in bbx3 container. With -it, cat works as expected. docker exec -it bbx3 cat hello hello # Execute a chained commands, only the first command is executed in container docker exec bbx3 hostname -i && hostname -i 172.17.0.4 127.0.1.1 # Execute a chained commands with sh -c, docker exec bbx3 sh -c \"hostname -i && hostname -i\" 172.17.0.4 172.17.0.4 ht t p s : / / d oc s . d oc k e r . c om / r e f e r e nc e / c li/ d oc k e r / c ont a ine r / e x e c / IN T 2 0 9 De v Op s history co mma n d : sh o w t h e h ist o r y o f a n im a g e ❍ a lia s o f docker image history 10 # View image history docker history nginx:alpine IMAGE CREATED CREATED BY SIZE COMMENT 02ffd439b71d 11 months ago /bin/sh -c set -x && apkArch=\"$(cat /etc… 30.8MB <missing> 11 months ago /bin/sh -c #(nop) ENV NJS_VERSION=0.7.11 0B <missing> 11 months ago /bin/sh -c #(nop) CMD [\"nginx\" \"-g\" \"daemon… 0B <missing> 11 months ago /bin/sh -c #(nop) STOPSIGNAL SIGQUIT 0B <missing> 11 months ago /bin/sh -c #(nop) EXPOSE 80 0B <missing> 11 months ago /bin/sh -c #(nop) ENTRYPOINT [\"/docker-entr… 0B <missing> 11 months ago /bin/sh -c #(nop) COPY file:e57eef017a414ca7… 16.4kB <missing> 11 months ago /bin/sh -c #(nop) COPY file:abbcbf84dc17ee44… 12.3kB <missing> 11 months ago /bin/sh -c #(nop) COPY file:5c18272734349488… 12.3kB <missing> 11 months ago /bin/sh -c #(nop) COPY file:7b307b62e82255f0… 8.19kB <missing> 11 months ago /bin/sh -c set -x && addgroup -g 101 -S … 6.85MB <missing> 11 months ago /bin/sh -c #(nop) ENV PKG_RELEASE=1 0B <missing> 11 months ago /bin/sh -c #(nop) ENV NGINX_VERSION=1.23.4 0B <missing> 11 months ago /bin/sh -c #(nop) LABEL maintainer=NGINX Do… 0B <missing> 11 months ago /bin/sh -c #(nop) CMD [\"/bin/sh\"] 0B <missing> 11 months ago /bin/sh -c #(nop) ADD file:e51d4089e73ad6dee… 8.14MB ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /im a g e /h is to r y / IN T 2 0 9 De v Op s history co mma n d 11 # View busybox image history docker history busybox IMAGE CREATED CREATED BY SIZE COMMENT 650fd573e056 10 months ago BusyBox 1.36.1 (glibc), Debian 12 4.17MB # Cannot run busybox without a command docker run --name busybox -d --rm busybox docker ps -a -f name=busybox CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES # May run busybox with sh # NB: need -it option docker run --name busybox -d --rm -it busybox sh docker ps -a -f name=busybox CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4e09b507fe92 busybox \"sh\" 6 seconds ago Up 5 seconds busybox bu s ybo x ha s no d e f a u lt c o m m a nd ! IN T 2 0 9 De v Op s cp co mma n d : co p y file s / fo ld e r s b e t w e e n a co n t a in e r a n d t h e lo ca l file s y s t e m ❍ c o n t a in er p a t h s a r e r ela t iv e t o t h e c o n t a in er ' s r o o t d ir ec t o r y 12 docker run --name busybox -d --rm -it busybox sh echo hello world > hello # Copy file ‘hello’ to ‘busybox’ container at /tmp docker cp hello busybox:tmp Successfully copied 2.05kB to busybox:tmp docker exec busybox cat /tmp/hello hello world # Copy file ‘index.html’ in container to host docker cp nginx:usr/share/nginx/html/index.html . ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /c p / IN T 2 0 9 De v Op s E x er c is e 1 : d ep lo y lv m x x y y y in c o n t a in er ❍ C r e at e an d r u n a c o n t ai n e r t o h o s t ‘ l v m x x y y y ’ ❍ Bas e - im a g e : ng inx:alp ine ❍ Name : lvm [x x y y y ] ❍ Re st a r t p o lic y : un les s - st o p p e d ❍ po r t : 0. 0. 0. 0: 3000 ❍ we b - pa g e : lvm x x y y y ❍ c o n t en t : lv m x x y y y . s it . k m u t t . a c . t h 13 IN T 2 0 9 De v Op s commit co mma n d : cr e a t e a n e w im a ge fr o m a co n t a in e r 's ch a n ge s 14 # commit the changes to the image ‘nginx:test’ docker commit nginx nginx:test # List all images with the image name ‘nginx’ docker images nginx # View history of nginx:test image docker history nginx:test ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /c o m m it/ IN T 2 0 9 De v Op s commit co mma n d Ex e r c is e 1. co m m it lv m xxy y y t o ‘ lv m xxy y y :b a r e ’ 15 IN T 2 0 9 De v Op s E x er c is e 2 : f et c h d a t e/ d a t ea p i in c o n t a in er 16 Ba c k - en d Br o ws er Fr o nt - en d fe t c h Jav a w e b ap p l i c at i o n s e rv e r ht m l/ c s s / j s .j ar St a t i c we b s e r ve r :3 0 0 0 :8 0 8 0 /a p i /d a t e /a p p bu ild Fir e w a ll lvm [ xxy y y ]. s i t . k m ut t . a c . t h /a p p bu ild ru n ht t p : 3 0 0 0 ht m l/ c s s / j s /d is t co p y :8 0 .j ar /ta r g e t co p y IN T 2 0 9 De v Op s d a t ea p i c o n t a in er ❍ C r e at e an d r u n a c o n t ai n e r t o h o s t ‘ d at e ap i ’ ❍ Bas e - im a g e : op en j d k : 1 7 - jd k - alp ine ❍ Name : da t e a p i ❍ Re st a r t p o lic y : un les s - st o p p e d ❍ po r t : 0. 0. 0. 0: 8080 17 IN T 2 0 9 De v Op s f et c h d a t e c o n t a in er ❍ C r e at e an d r u n a c o n t ai n e r t o h o s t ‘ d at e ap i ’ ❍ Bas e - im a g e : ng inx:alp ine ❍ Name : fe t ch d a t e ❍ Re st a r t p o lic y : un les s - st o p p e d ❍ po r t : 0. 0. 0. 0: 3000 18 IN T 2 0 9 De v Op s B in d m o u n t s w it h -- mount f la g ❍ Wit h b in d m o u n t , a file o r d ir e c t o r y o n t h e h o s t m a c h in e is m o u n t e d in t o a c o n t a in e r . ❍ Th e f ile or d irec t ory is ref eren c ed b y it s ab s o lu te p ath on t h e h os t mac hine . 19 # bind mount current directory to /src docker run -it --rm --mount type=bind,source=$(pwd),target=/src busybox # run the following commands in container cd /src; ls touch newfile exit # newfile is listed with ‘root’ ownership ls -l ht t p s : / / do c s . do c k e r. c o m /s to r a g e /b in d - mo un t s / IN T 2 0 9 De v Op s E x er c is e 3 ❍ Re d o Ex e r c i s e 2 wi t h b i n d mo u n t 20","libVersion":"0.3.1","langs":""}