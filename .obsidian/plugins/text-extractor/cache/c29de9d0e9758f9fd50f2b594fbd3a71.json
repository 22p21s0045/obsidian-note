{"path":"Lecture Kmutt/INT210/materials/2023-INT209-01 Introduction to Docker v0.9.1 (1).pdf","text":"INT 2 0 9 D ev O p s LA B - 01 I n t r o d uc t io n t o D o c k e r Ol a r n R o j a n a po r n pu n Th u rs d ay , 1 4 Marc h 2 0 2 4 IN T 2 0 9 De v Op s D o cke r i s u se d t o ru n s o ftw a r e p a c k a g e s ca l l e d \"co n t a i n e rs\". C o n ta i n e r s a r e i s o l a te d f ro m e a ch o t h e r a n d b u n d l e t h e i r o w n a p p l i ca t i o n , t o o l s, l i b ra ri e s a n d co n ﬁg u ra t i o n ﬁl e s; t h e y ca n co mmu n i ca t e w i t h e a ch o t h e r t h ro u g h w e l l -d e ﬁn e d ch a n n e l s. Al l co n t a i n e rs a re ru n b y a si n g l e o p e ra t i n g syst e m ke rn e l a n d a re t h u s mo re l i g h t w e i g h t t h a n vi rt u a l ma ch i n e s. C o n ta i n e r s a r e c r e a te d fr o m \" i m a g e s \" t h a t sp e ci f y t h e i r p re ci se co n t e n t s. I ma g e s a re o f t e n cre a t e d b y co mb i n i n g a n d mo d i f yi n g st a n d a rd i ma g e s d o w n l o a d e d f ro m p u b l i c re p o si t o ri e s. h ttp s :/ / e n . w i k i p e d i a . o r g / w i k i / D o c k e r _ (s o ftw a r e ) D o cke r i s a n o p e n p l a t f o rm f o r d e ve l o p i n g , sh i p p i n g , a n d ru n n i n g a p p l i ca t i o n s. D o cke r e n a b l e s yo u t o s e p a r a te y o u r a p p l i c a ti o n s fr o m y o u r i n fr a s tr u c tu r e so yo u ca n d e l i ve r so f t w a re q u i ckl y . W i t h D o cke r , yo u ca n ma n a g e yo u r i n f ra st ru ct u re i n t h e sa me w a ys yo u ma n a g e yo u r a p p l i ca t i o n s. By t a ki n g a d va n t a g e o f D o cke r ’ s me t h o d o l o g i e s f o r sh i p p i n g , t e st i n g , a n d d e p l o yi n g co d e q u i ckl y , yo u ca n s i g n i ﬁ c a n tl y r e d u c e th e d e l a y b e tw e e n w r i ti n g c o d e a n d r u n n i n g i t i n p r o d u c ti o n . h ttp s :/ / d o c s . d o c k e r . c o m / e n g i n e / d o c k e r -o v e r v i e w / 2 Cr e a t e d b y Da m r o n g s a k Re e t a n o n , M FE C IN T 2 0 9 De v Op s D o cke r i s w ri t t e n i n Go a n d t a ke s a d va n t a g e o f s e v e r a l fe a tu r e s o f th e Linux kernel t o d e l i ve r i t s f u n ct i o n a l i t y . D o cke r u se s a t e ch n o l o g y ca l l e d namespaces t o p ro vi d e t h e i s o l a te d workspace ca l l e d t h e co n t a i n e r . W h e n yo u ru n a co n t a i n e r , D o cke r cre a t e s a se t o f n a me sp a ce s f o r t h a t co n t a i n e r . 3 Cr e a t e d b y Da m r o n g s a k Re e t a n o n , M FE C IN T 2 0 9 De v Op s D o c k er C o n t a in er IN T 2 0 9 De v Op s DEV PROD V M a n d C o n t a in er t o g et h er IN T 2 0 9 De v Op s Im age Th e b a s is of a Doc k er c on t a in er. Th e c on t en t a t res t . Co n t ai n e r Th e im a g e w h en it is ‘ run n in g . ’ Th e s t a n d a rd un it f or a p p s erv ic e En g i n e Th e s of t w a re t h a t ex ec ut es c om m a n d s f or c on t a in ers . N et w ork in g and v o lu me s ar e p ar t o f E ngine . Can b e c lu s te r e d to ge the r . Re g i s t ry St o r e s , d is t r ib u t e s a n d m a n a g e s D o c k e r im a g e s D o c k er B a s ic IN T 2 0 9 De v Op s D o c k er I m a g e IN T 2 0 9 De v Op s D o c k er I m a g e L a y er ( 1 ) IN T 2 0 9 De v Op s D o c k er I m a g e L a y er ( 2 ) IN T 2 0 9 De v Op s W h a t is in D o c k er I m a g e ❍ Bas e O S (Ub u nt u , C ent OS , Al p i ne) ❍ Sy s t e m Pa c k a g e s (APT , YUM ) ❍ Li b r a r y D e p e n d e n c i e s (PIP, NPM , C om p os er ) ❍ Co n fig u ra t io n ❍ So ur c e C o d e IN T 2 0 9 De v Op s D o c k er C o n t a in er IN T 2 0 9 De v Op s R u n n in g C o n t a in er IN T 2 0 9 De v Op s Do c k e r Ima g e i s like a pro gram Do c k e r Co n t a i n e r i s like a pro c e s s D o c k er I m a g e v s C o n t a in er Do c k e r Ima g e i s l i k e a cl a s s Do c k e r Co n t a i n e r i s l i k e a in s t an c e o f c las s IN T 2 0 9 De v Op s Kernel Docker driver, aufs/btrfs/overlay Host OS (CentOS) Ubuntu base Bins/LibsApp A1App A2Docker engine Busybox base bins/libs Python Apache PHPApp B DemoApp B ProdData Container for App A1 App B CentOS base Bins/LibsApp D1App D2 Python ApacheApache PHPApp E DemoApp E Prod App BData Container for App A2Data Container for App B ProdData Container for App CApp CApp F Docker Image Docker Container Docker Base Image App A C App A C D o c k er L a y er IN T 2 0 9 De v Op s D o c k er f ile ❍ Doc k er f i l e is in s t r u c t ion s t o bu ild D o c k e r I m ag e ❍ Ho w to r u n c o mmand s ❍ Ad d f ile s o r d ir e c to r ie s ❍ Cr e ate e nv ir o nme nt v ar iab le s ❍ Wh a t p r o c e s s t o r u n w h e n la u n c h in g co n t a in e r ❍ Re su l t f r o m b u i l d i n g Doc k er f i l e is D o c k e r I m ag e IN T 2 0 9 De v Op s FROM node:14.14.0 - alpine3.12 COPY . / nodejs /. WORKDIR / nodejs RUN npm install ENV VERSION 1.0 EXPOSE 8081 CMD [\"node\", \"/ nodejs / main.js \"] S a m p le D o c k er f ile OS + S ys t em P a c k a g es So u r c e C o d e Lib ra ry D e p e n d e n c ie s Co nf ig u r atio n IN T 2 0 9 De v Op s D o c k er R eg is t r y ❍ D o c k e r R e g i s t r y i s t h e s t o r e f o r D o c k e r I m ag e ❍ D o c k e r Hu b i s p u b l i c D o c k e r R e g i s t r y l i k e Gi t h u b ❍ U s i n g D o c k e r c l i e n t t o p u s h an d p u l l D o c k e r I m ag e f r o m D o c k e r R e g i s t r y ❍ Y o u c an c r e at e y o u r o w n P r i v at e D o c k e r Re g i str y IN T 2 0 9 De v Op s D o c k er H u b IN T 2 0 9 De v Op s De v e l o p e r s IT Op e r a tio n s BUI L D D e ve l o p m e n t E n vi r o n m e n t s SH I P S e cu r e C o n t e n t & C o l l a b o r a t i o n RUN D e p l o y , M a n a g e , S ca l e Re g i s t r y Co n t r o l p l a n e Mu lti - cont ai ner apps En g i n e s r u n n i n g on ser ver s i n cl oud or dat acent er Im a g e s s to r e d in r e p o s Cl i e n t s p u l l a n d push i m ages D o c k er a n d D ev O p s IN T 2 0 9 De v Op s 20 C o n ta i n e r s a n d I m a g e s L i fe c y c l e D o cke rﬁl e I ma g e s C o n t a i n e rs Arch i ve tag build run commit start   stop   r estart save & load I ma g e s r e g i s tr y push pull I ma g e s C o n t a i n e rs pull run Cr e a t e d b y Da m r o n g s a k Re e t a n o n , M FE C IN T 2 0 9 De v Op s D o cke r D a e mo n (d o cke rd ) R EST APID o cke r C L I (d o cke r) co n t a i n e r i ma g e n e t w o rk vo l u me s • U N I X So c k e t • TCP 21 D o c k er A r c h it ec t u r e Cr e a t e d b y Da m r o n g s a k Re e t a n o n , M FE C IN T 2 0 9 De v Op s Host D o c k er E n g in e W eb S er v er 80 xxxx D o c k er C o n t a in er s Da t a b a se D o c k er C lien t so cket 3306 D o c k er A r c h it ec t u r e IN T 2 0 9 De v Op s $ docker run -i -t centos /bin/bash Local Checking image locally $ docker images Cr eate new container Pull image fr om r egistry Allocate R W ﬁlesystem Cr eate network interface Start container Execute /bin/bash r egistry 23 Cr e a t e d b y Da m r o n g s a k Re e t a n o n , M FE C ht t p s : / / d oc s . d oc k e r . c om / g e t - st a r t e d / o v e r v ie w / $ d ocker run - it ubuntu /bin/bash $ d ocker images IN T 2 0 9 De v Op s I n s t a ll D o c k er o n U b u n t u ❍ Re f e r t o h t t p s : / / d o c s . d o c k er . c o m / en g in e/ in s t a ll/ u b u n t u / fo r in s t r u ct io n s ❍ in s t a ll t h e la t e s t ve r s io n u s in g ap t ❍ Pe r f o r m p o s t - in s t a lla t io n h t t p s : / / d o c s . d o c k er . c o m / en g in e/ in s t a ll/ lin u x - p o s t in s t a ll/ ❍ ad d sysadmin to docker gr o u p ❍ co n figu r e ‘ lo ca l’ a s lo ggin g dr iv e r a n d a dd m ir r o r 24 sudo usermod -aG docker sysadmin { \"log-driver\": \"local\", \"log-opts\": { \"max-size\": \"10m\" }, \"registry-mirrors\": [\"https://lvmolarn.sit.kmutt.ac.th\"] } /etc/docker/daemon.json IN T 2 0 9 De v Op s D o c k er H elp 25 # To show Docker online help docker # To show Docker run command help # Note the alias is ‘docker container run’ docker run --help # Show docker disk usage help docker system df --help IN T 2 0 9 De v Op s D o c k er I m a g e 26 # To show Docker Image on your machine docker images # To pull ubuntu image with tag latest from Docker Hub docker pull ubuntu # To show your newly pull ubuntu image on your machine docker images # Pull Ubuntu 20.04 docker pull ubuntu:20.04 # To show Docker Image on your machine docker images IN T 2 0 9 De v Op s D o c k er C o n t a in er 27 # Run first ubuntu container docker run ubuntu echo \"Hello World\" # Run container with bash command docker run -i -t ubuntu bash # Below command are run inside container whoami hostname cat /etc/*release* exit IN T 2 0 9 De v Op s D o c k er C o n t a in er B a s ic O p er a t io n 28 # Show running containers docker ps # Show running and stopped containers docker ps -a # Run container with specify name docker run --name ubuntu-universe ubuntu echo \"Hello Universe\" docker ps -a # Delete container by name docker rm ubuntu-universe docker ps -a # Delete container by part of container id docker rm 07f docker ps -a IN T 2 0 9 De v Op s R u n D o c k er a s d a em o n a n d ex p o s e p o r t 29 # Run Nginx docker run nginx:alpine docker ps -a # Run Nginx in background docker run -d nginx:alpine docker ps # Export 8080 port from outside forward to port 80 on container docker run -d -p 8080:80 nginx:alpine # What happen if try to expose same port again docker run -d -p 8080:80 nginx:alpine # What happen if we expose difference outside port docker run -d -p 8888:80 nginx:alpine # You can try view the web again docker ps IN T 2 0 9 De v Op s D o c k er E x er c is e ❍ T r y t o r u n A p ac h e S e r v e r 2 . 4 . 3 3 o n A l p i n e L i n u x an d exp o s e t o p o r t 8 0 8 3 30 IN T 2 0 9 De v Op s D o c k er U t ilit ies C o m m a n d s 31 # Rename container name docker rename vigorous_sammet nginx # To go inside running container docker exec -it nginx sh ls -l ps -ef exit # Show container processes docker top nginx # Show logs docker logs nginx # Follow logs docker logs nginx -f # Try Web preview to see log running # Show container resource consumes docker stats # Show container all metadatas docker inspect nginx","libVersion":"0.3.1","langs":""}