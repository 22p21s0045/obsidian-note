{"path":"Lecture Kmutt/INT206/material/INT206_06_Transaction_Management_Part2_02_2023.pdf","text":"IN T 2 0 6 Tr a n s a c t i o n M a n a g e m e n t Par t 2 Sani t Si r i s aw at v at ana and Suni s a Sat hapor nw aj ana Se r i a l i za b i l i t y a n d R e co ve r a b i l i t y • Wh e n mu l t i p l e t r a n s a c t i o n s r u n c o n c u r r e n t l y , t h e r e i s a pos s i bl e t hat t he dat abas e m ay be l ef t i n an in c o n s is t e n t st a t e . • Th e o b j e c t i v e o f a c o n c u r r e n c y c o n t r o l p r o t o c o l • is t o sch e d u le t r a n sa ct io n s in su ch a w a y a s t o a vo id a n y in t e r f e r e n ce b e t w e e n t h e m • henc e pr ev ent t he t y pes of pr obl em des c r i bed i n t he pr ev i ous par t . Se r i a l Sc h e d u l e v s . N o n - ser i al S cedul e • Sch e d u l e • A s e q u e n c e o f t h e o p e r a t i o n s b y a s e t o f c o n c u r r e n t t r a n s a c t i o n s t h a t pr es er v es t he or der of t he oper at i ons i n eac h of t he i ndi v i dual tr a n s c ti o n s . • Se r i a l sch e d u l e • I s a l w a ys a se r i a l i za b l e sch e d u l e . • A s c h e d u l e w h e r e o p e r t i o n s o f e a c h t r a n s a c t i o n a r e e x e c u t e d co n se cu t i ve w i t h o u t a n y i n t e r l e a ve d o p e r a t i o n s f r o m o t h e r tr a n s a c ti o n s . • A t r a n s a c t i o n o n l y s t a r t s w h e n t h e o t h e r t r a n s a c t i o n f i n i s h e d e x e c u t e d . • No n - se ri a l sch e d u l e • A s c h e d u l e w h e r e t h e o p e r a t i o n s f r o m a s e t o f c u r r e n t t r a n s a c t i o n s ar e in t e r le a v e d . • Is s a i d to b e s e r i a l i z a b l e s c h e d u l e , i f i t i s e q u i v a l e n t to th e s e r i a l sch e d u l o f t h o se n t r a n a sct i o n s. Se r i a l i za b i l i t y • Th e o b j e c t i v e o f s e r i a l i z a b i l i t y • I s t o f i n d n o n se r i a l sch e d u l e s t h a t a l l o w t r a n sa ct i o n s t o e xe cu t e co n cu r r e n t l y w i t h o u t i n t e r f e r i n g w i t h o n e a n o t h e r , a n d t h e r e b y p r o d u ce a dat abas e s t at e t hat c oul d be pr oduc ed by a s er i al ex ec ut i on. • In s e r i a l i z a b i l i ty , th e o r d e r i n g o f r e a d /w r i te s i s i m p o r ta n t: • If tw o tr a n s a c ti o n s onl y r ead a dat a i t em , th e y d o not c onf l i c t and or der is n o t im p o r t a n t . • If tw o tr a n a c ti o n s ei t her r ead or wr i t e co m p l e t e l y se p a r e n t d a t a i t e m s , th e y do not c onf l i c t and or der i s not i m por t ant . • If o n e tr a n s a c ti o n wr i t es a dat a i t em and anoht er r eads or wr i t es s am e dat a i t em , or der of ex ec ut i on i s i m por t ant . Re c o v e r a b l i l i t y • Ser i al i z abi l i t y id e n t if ie s s c h e d u le s t h a t m a in t a in t h e co n si st e n cy o f d a t a b a se , a ssu m i n g t h a t n o n e o f t h e tr a n s a c ti o n s i n th e s c h e d u l e fa i l s . • Re c o v e r a b l i t y o f t r a n s a c t i o n s wi t h i n a s c h e d u l e : • If a tr a n s a c ti o n fa i l s , th e at om i c i t y pr oper t y re q u i re s t h a t w e u n d o th e e f fe c ts o f tr a n s a c ti o n s . • Th e dur abi l i t y pr oper t y st a t e s t h a t o n e a t r a n sa ct io n co m m it s, it s ch a n g e s ca n n o t b e u n d o n e ( w it h o u t r u n n in g a n o t h e r , co m p e n sa t in g , t r a n sa ct io n ) . Un r e c o v e r a b l e S c h e d u l e • G i s nonr ec ov er abl e s c hedul e , b e c a u s e T 2 r e a d th e v a l u e of A w r i t t en by T1 , a n d co m m i t t e d . • T1 l a t e r a b o r t e d , t h e r e f o r e t h e va l u e r e a d b y T2 i s w r o n g , but s i nc e T 2 c om m i t t ed. Re c o v e r a b l e S c h e d u l e • A sch e d u l e wher e, fo r eac h pai r of tr a n s a c ti o n s T i and T j , if T j re a d s a dat a it e m pr ev i ous l y wr i t t en by T i , th e n th e co m m i t oper at i on of T i pr ec edes th e co m m i t oper at i on of T j . • F is re c o v e ra b l e bec aus e T 1 co m m i t s bef or e T 2 , th a t ma k e s th e va l u e re a d by T 2 co r r e ct s, Th e n T 2 ca n co m m i t it s e lf . • In F 2 is re c o v e ra b l e , if T 1 abor t ed, T 2 has to abor t bec aus e th e va l u e of A it re a d is in c o r r e c t Co n c u r r e n c y Co n t r o l T e c h n i q u e s • Se r i a l i z a b i l i t y ca n b e a ch i e ve d i n se ve r a l w a ys. • Tw o co n cu r r e n cy co n t r o l te c h n i q u e s • Loc k i ng • Ti m e s t a m p i n g • Bo t h a r e co n se r va t i ve (o r pes s i m i s t i c ) a p p ro a c h e s • Th e y ca u se t r a n sa ct i o n t o b e d e l a ye d w h e n t h e y co n f l i ct wi t h o t h e r t r a n s a c t i o n s • Op t i mi s t i c appr oac hes bas ed on: • Tr a n s a c t i o n c o n f l i c t is r a r e . So th e y a l l o w tr a n s a c ti o n s to r u n u n s y n c h r o n i z e d a n d c h e c k fo r c o n fl i c ts o n l y w h e n th e tr a n s a c ti o n c o m m i ts a t th e e n d Loc k i ng M et hods • De f i n i t i o n : • A pr oc edur e us ed t o c ont r ol co n cu r r e n cy a cce ss to d a ta . T r a n s a c ti o n us es l oc k s t o deny ac c es s to o th e r tr a n s a c ti o n s to pr ev ent i nc or r ec t re s u l t s . • Loc k i ng m et hods ar e t he m os t w i del y us ed appr oac h t o ens ur e se ri a l i za b i l i t y o f co n cu rre n t t ra n sa ct i o n s . • Tr a n s a c t i o n m u s t r e q u e s t a l oc k on a dat a i t em bef or e i t r ead or wr i t e t h e d a t a i t e m . • Th e l o c k pr ev ent s anot her t r ans ac t i on f r om m odi f y i ng or r eadi ng th e i te m . • Th e o t h e r t r a n s a c t i o n m u s t w a i t u n t i l t h e l o c k i s r e l e a s e d . Ty p e s o f a l o c k • Tw o t y p e s : • Shar ed l oc k (re a d l o c k ) • Is u s e d fo r re a d - onl y mo d e ( re a d i n g p u rp o s e ) • Tr a n s a c t i o n r e q u e s t s s h a r e d l o c k o n a d a t a i t e m in o r d e r to re a d it s co n t e n t . • Up d a t i n g t h e d a t a i s n o t a l l o we d • Ex c l us i v e l oc k (w ri t e l o c k ) • Is u s e d fo r wr i t e m o d e • On ly t h e t r a n sa ct io n t h a t r e q u e st s a lo ck ca n r e a d a n d u p d a t e th e d a ta i te m • Th e o t h e r t r a n s a c t i o n s c a n n o t r e a d , w r i t e o r l o c k t h e d a t a a n d mu s t w a i t u n t i l t h e l o c k i s r e l e a s e d Fl o w ch a rt of l oc k i ng Loc k M at r i x T1 i s s ue a l oc k a t t = 0 T2 i s s u e a l o c k a t t = 1 0 Sh a r e d Ex c l u s i v e Sh a r e d Bo t h are grant ed shar ed lo c k s Bo t h o n l y R e a d On l y T 1 i s g r a n t e d an excl usi ve l ock T2 w a i t fo r a lo c k T1 R e a d / W r i t e Ex c l u s i v e On l y T 1 i s g r a n t e d a shar ed l ock T2 wa i t f o r a l o c k T1 o n l y R e a d On l y T 1 i s g r a n t e d an excl usi ve l ock T2 w a i t fo r a lo c k T1 R e a d / W r i t e So m e s y s t e m s a l l o w t r a n s a c t i o n t o upgr ade sh a r e d ( r e a d ) lo ck t o a n ex c l us i v e l oc k , or dow ngr ade ex c l us i v e l oc k t o a s har ed l oc k . Loc k i ng G r anul ar i t y Da t a b a s e Ta b l e Pa g e Re c o r d Co l u m n Exa m p l e : I n co r r e ct l o cki n g sch e d u l e T9 e x e c u t e s b e f o r e T1 0 T1 0 e xe cu t e s b e f o re T9Loc k i ng • Loc k i ng i n t r ans ac t i ons does not guar ant ee s er i al i z abi l i t y of s c hedul es • Th e p r o b l e m o f i n co r r e ct l o cki n g sch e d u l e i s t h a t • Th e t r a n s a c t i o n s re l e a s e l o c k s t o o s o o n af t er ex ec ut i ng r ead/ w r i t e oper at i ons • It a l l o w s tr a n s a c ti o n s to in t e r f e r e w it h o n e a n o t h e r • Th i s r e s u l t s in lo ss o f t o t a l iso la t io n a n d a t o m icit y . • To g u a r a n t e e s e r i a l i z a b i l i t y • Ne e d s a n a d d i t i o n a l p r o t o c o l c o n c e r n i n g t h e p o s i t i o n i n g o f l o c k a n d unl oc k oper at i ons i n ev er y t r ans ac t i on. • Th e bes t k now n pr ot oc ol i s tw o - phas e l oc k i ng (2 P L ) Tw o - phas e l oc k i ng ( 2P L) • De f i n i t i o n : • Al l l o c k i n g o p e r a t i o n s p r e c e d e t h e f i r s t u n l o c k o p e r a t i o n s i n t h e tr a n s a c ti o n . • Ru l e s • Ev e r y t r a n s a c t i o n c a n b e d i v i d e d i n t o tw o p h a s e s • Gr o w i n g p h a s e • Tr a n s a c t i o n m u s t a c q u i r e a l o c k b e f o r e o p e r a t i n g ( r e a d / w r i t e ) o n t h e i t e m . • It a c q u i r e s a l l th e l o c k s b u t c a n n o t r e l e a s e a n y l o c k s • Th e r e i s n o r e q u i r e m e n t t h a t a l l l o c k s b e o b t a i n e d a t t h e s a m e t i m e • Tr a n s a c t i o n a c q u i r e s s o m e l o c k s , d o e s s o m e p r o c e s s i n g , a n d g o e s o n t o ac qui r e addi t i onal l oc k s as needed. • Sh r i n k i n g p h a s e • Wh e n n o n e w lo c k s a r e n e e d e d , it r e le a s e s it s lo c k s b u t c a n n o t a c q u ir e a n y new l oc k s . Tw o - phas e l oc k i ng ( 2P L) Time Growing phase BOT EOT Shrinking phaseLocks held Pr e v e n t i n g t h e l o s t u p d a t e p r o b l e m usi ng 2P L Pr e v e n t in g Un c o m m it t e d De p e n d e n c y Pr o b le m us i ng 2P L 22 Pr e v e n t i n g I n c o n s i s t e n t An a l y s i s Pr o b l e m usi ng 2P L Pe a r s o n E d u c a t i o n © 2 0 0 9 De a d l o c k • De f i n i t i o n : • Tw o ( o r m o r e ) t r a n s a c t i o n s w a i t f o r l o c k s o n i t e m s t o b e r e l e a s e d t h a t ar e hel d by t he ot her t r ans ac t i ons • Th i s i s a p r o b l e m o f u s i n g t w o - phas e l oc k i ng, w hi c h appl i es t o al l l oc k i ng - bas ed s c hem es • Wh e n d e a d l o c k o c c u r s , t h e a p p l i c a t i o n s i n v o l v e d c a n n o t re so l ve t h e p ro b l e m • Th e D B M S has t o re co g n i ze t h e d e a d l o ck a n d b re a k t h e deadl oc k i n s om e w ay . • Th e o n l y w a y t o b r e a k d e a d l o c k i s abor t i ng one or m or e of tr a n s a c ti o n s ( re q u i ri n g t o u n d o i n g a l l t h e ch a n g e s ma d e b y abor t ed t r ans ac t i ons ) Exa m p l e : D e a d l o ckTe c h n i q u e s f o r h a n d l i n g d e a d l o c k • Th r e e t e c h n i q u e s : • Ti m e o u t s • De a d l o c k p r e v e n t i o n • De a d l o c k d e t e c t i o n Ti m e o u t s • Si m p l e a p p r o a c h i s b a s e d o n l o c k t i m e o u t s • A t r a n s a c t i o n t h a t r e q u e s t s a l o c k w i l l w a i t f o r a syst e m - def i ned peri od of t i m e • If th e l o c k h a s b e e n g r a n te d w i th i n th i s p e r i o d , th e lo c k r e q u e s t t im e s o u t • Ca n a b o r t t r a n s a c t i o n s t h a t a r e n o t d e a d l o c k e d • Ti m e o u t s i s u s e d b y s e v e r a l c o m m e r c i a l D B M S s De a d l o c k p r e v e n t i o n • DB MS l o o k s a h e a d t o s e e i f t r a n s a c t i o n wo u l d c a u s e deadl oc k and nev er al l ow s deadl oc k t o oc c ur . • Co u l d o r d e r t r a n s a c t i o n s u s i n g t r a n s a c t i o n t i me s t a mp s : • Wa i t - Di e a l g o r i t h m • Wo u n d - Wa i t a l g o r i t h m De a d l o c k d e t e c t i o n • DB MS a l l o ws d e a d l o c k t o o c c u r b u t r e c o g n i z e s i t a n d br eak s i t . • To d e t e c t t h e d e a d l o c k • Is to c h e c k a l l o c a ti o n a g a i n s t r e s o u r c e a v a i l a b i l i ty fo r a l l p o s s i b l e al l oc at i on s equenc es t o det er m i ne i f t he s y s t em i s i n deadl oc k st a t e . • On c e a d e a d l o c k i s d e t e c t e d , t h e D BM S n e e d s t o a b o r t i t and needs t o be a w ay t o r ec ov er y t he abor t ed tr a n s a c ti o n s . • Us e d b y e n t e r p r i s e DB M S s s u c h a s O r a c l e Ca s c a d i n g Ro l l b a c k • Ev er y t r ans ac t i on i n a s c hedul e f ol l ow s 2PL, s c hedul e i s se r i a l i za b l e . • Ho we v e r , p r o b l e ms c a n o c c u r wi t h i n t e r p r e t a t i o n o f wh e n lo c k s c a n b e r e le a s e d . • Ca s c a d i n g r o l l b a c k o c c u r s wh e n a t r a n s a c t i o n ( T 1 ) ca u se s a fa i l u r e and a r ol l bac k m us t be per f or m ed. • Ot h e r t r a n s a c t i o n s d e p e n d e n t o n T 1 ’ s a c t i o n s m u s t a l s o be r ol l bac k ed due t o T 1’ s f ai l ur e. Ca s c a d i n g Ro l l b a kTi m e s t a m p i n g M e t h o d s • De f i n i t i o n : • A u n i q u e i d e n t i f i e r c r e a t e d b y D B M S t h a t i n d i c a t e s r e l a t i v e s t a r t i n g ti m e o f a tr a n s a c ti o n . • Is a n o th e r a p p r o a c h to g u a r a n te e s e r i a l i z a b i l i ty b y or der i ng t r ans ac t i on ex ec ut i on fo r a n e q u i v a l e n t s e r i a l sch e d u l e • No l o c k i n g ar e i nv ol v ed, No d e a d l o c k • Tr a n s a c t i o n s a r e not w ai t i ng fo r l o c k i n g • Tr a n s a c t i o n s i n v o l v e d i n c o n f l i c t a r e s i m p l y ro l l e d b a c k and re s t a rt e d 34 Op t i m i s t i c T e c h n i q u e s • Bas ed on as s um pt i on th a t co n f l i ct is ra re and mo r e ef f i c i ent to le t tr a n s a c ti o n s pr oc eed wi t h o u t del ay s to ens ur e se r i a l i za b i l i t y . • At co m m i t , ch e ck is ma d e to det er m i ne wh e t h e r co n f l i ct has oc c ur r ed . • If th e r e is a co n f l i ct , tr a n s a c ti o n mu s t be ro l l e d bac k and re s t a rt e d . • Pot ent i al l y al l ow s gr eat er co n cu r r e n cy th a n tr a d i ti o n a l pr ot oc ol s . Pe a r s o n E d u c a t i o n © 2 0 0 9 Da t a b a s e Re c o v e r y • De f i n i t i o n : • Pr o c e s s o f r e s t o r i n g d a t a b a s e t o a c o r r e c t s t a t e i n t h e e v e n t o f a fa i l u r e . • Tr a n s a c t i o n s r e p r e s e n t b a s i c u n i t o f r e c o v e r y . • Re c o v e r y ma n a g e r r e s p o n s i b l e f o r a t o mi c i t y a n d dur abi l i t y . 36 Ty p e s o f F a i l u r e s • Sy s t em cr a sh e s , re s u l t i n g in lo s s of ma i n me mo r y . • Me d i a fa i l u r e s , re s u l t i n g in lo s s of par t s of se co n d a r y st o r a g e . • Appl i c at i on so f t w a r e er r or s . • Na t u r a l phy s i c al di s as t er s . • Ca r e l e s s n e s s or uni nt ent i onal des t r uc t i on of dat a or fa c i l i ti e s . • Sabot age . Pe a r s o n E d u c a t i o n © 2 0 0 9 Tr a n s a c t i o n s a n d R e c o v e r y • If fa i l u r e o c c u r s b e tw e e n c o m m i t a n d d a ta b a s e b u f fe r s bei ng f l us hed t o s ec ondar y s t or age t hen, t o ens ur e dur abi l i t y , r ec ov er y m anager has t o re d o ( ro l l f o rw a rd ) tr a n s a c ti o n ’ s u p d a te s . • If tr a n s a c ti o n h a d n o t c o m m i tte d a t fa i l u r e ti m e , r e c o v e r y ma n a g e r has t o undo ( ro l l b a c k ) a n y e f f e c t s o f t h a t tr a n s a c ti o n fo r a to m i c i ty . • Par t i al undo - onl y one t r ans ac t i on has t o be undone. • Gl o b a l u n d o - al l t r ans ac t i ons hav e t o be undone. 38 Exam ple • DB MS s t a r t s a t t i me t 0 , b u t fa i l s a t ti m e t f . A s s u m e d a ta fo r tr a n s a c ti o n s T 2 and T 3 hav e been w r i t t en t o s ec ondar y st o r a g e . • T 1 and T 6 had not co m m i t t e d t f . Th e r e f o r e at re s t a rt th e re c o v e ry ma n a g e r mu s t undo tr a n s a c ti o n s T 1 and T 6 . • In abs enc e of any ot her in f o r m a t io n , re c o v e ry ma n a g e r has to re d o T 2 , T 3 , T 4 , and T 5 . Pe a r s o n E d u c a t i o n © 2 0 0 9 39 Re c o v e r y Fa c i l i t i e s • DB MS sh o u l d pr ov i de fo l l o w i n g fa c i l i ti e s to as s i s t wi t h re c o v e ry : • Ba c k u p me c h a n i s m , wh i c h ma k e s peri odi c bac k up co p i e s of dat abas e . • Loggi ng fa c i l i ti e s , wh i c h ke e p tr a c k of cu r r e n t st a t e of tr a n s a c ti o n s and dat abas e ch a n g e s . • Ch e c k p o i n t fa c i l i ty , wh i c h enabl es updat es to dat abas e in progres s to be ma d e perm anent . • Re c o v e r y ma n a g e r , wh i c h al l ow s DB M S to res t ore dat abas e to co n si st e n t st a t e fo l l o w i n g a fa i l u r e . Pe a r s o n E d u c a t i o n © 2 0 0 9 40 Log F i l e • Co n t a i n s in f o r m a t io n about al l updat es to dat abas e : • Tr a n s a c t i o n re c o rd s . • Ch e c k p o i n t re c o rd s . • Is of t en us ed fo r pur pos es : • Re c o v e r y • Pe r f o r m a n c e mo n i t o r i n g and audi t i ng • To re c o v e r qui c k l y fr o m mi n o r fa i l u r e s • Th i s re q u i re s th a t th e lo g fi l e be st o r e d onl i ne on a fa s t di r ec t - ac c es s st o r a g e dev i c e Pe a r s o n E d u c a t i o n © 2 0 0 9 Ch e c k p o i n t i n g • De f i n i t i o n : • Po i n t o f s y n c h r o n i z a t i o n b e t w e e n d a t a b a s e a n d l o g f i l e . Al l b u f f e r s a r e fo r c e - wr i t t en t o s ec ondar y s t or age. • Ch e c k p o i n t s ar e s c hedul ed at pr edef i ned i nt er v al s and i nv ol v e th e fo l l o w i n g o p e r a ti o n s : • wr i t i ng al l l og r ec or ds i n m ai n m em or y t o s ec ondar y s t or age • wr i t i ng t he m odi f i ed bl oc k s i n t he dat abas es buf f er s t o s ec ondar y st o r a g e • wr i t i ng a c hec k poi nt r ec or d t o t he l og f i l e. T hi s r ec or d c ont ai ns t he id e n t if ie r s o f a ll t r a n s a c t io n s t h a t a r e a c t iv e a t t h e t im e o f t h e ch e ckp o i n t • Wh e n f a i l u r e o c c u r s , r e d o a l l t r a n s a c t i o n s t h a t c o m m i t t e d s i n c e th e c h e c k p o i n t a n d u n d o a l l tr a n s a c ti o n s a c ti v e a t ti m e o f cra sh . Ch e c k p o i n t i n g • In p r e v i o u s e x a m p l e , w i th c h e c k p o i n t a t ti m e tc , c h a n g e s m a d e by T 2 and T 3 hav e been w r i t t en t o s ec ondar y s t or age. • Th u s : • Th e r e c o v e r y m a n a g e r o m i t s t h e r e d o f o r T2 a n d T3 . • onl y r edo T 4 and T 5 s i nc e t he c hec k poi nt . • undo t r ans ac t i ons T 1 and T 6. Re c o v e r y T e c h n i q u e s • If d a ta b a s e h a s b e e n d a m a g e d : • Ne e d t o r e s t o r e l a s t bac k up c opy of dat abas e and r eappl y updat es of c om m i t t ed t r ans ac t i ons us i ng lo g f ile . • If d a ta b a s e i s o n l y i n c o n s i s te n t: • Fo r e x a m p l e , t h e s y s t e m c r a s h e d w h i l e t r a n s a c t i o n s w e r e ex ec ut i ng. • Ne e d t o undo c hanges th a t c a u s e d i n c o n s i s te n c y . M a y a l s o need t o re d o so m e t ra n sa ct i o n s to e n s u r e u p d a te s r e a c h se co n d a ry st o ra g e . • Do n o t n e e d bac k up, but ca n re st o re d a t a b a se u si n g th e l o g fi l e .","libVersion":"0.3.1","langs":""}