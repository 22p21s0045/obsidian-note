{"path":"Lecture Kmutt/INT210-LAB/materials/2023-INT209-02 Deploy server in container manually v0.9.pdf","text":"INT 2 0 9 D ev O p s LAB - 02 D ep lo y s er v er in c o n t a in er m a n u a lly Ol a r n R o j a n a po r n pu n Th u rs d ay , 2 1 Marc h 2 0 2 4 IN T 2 0 9 De v Op s D o c k er C h ea t S h eet ❍ http s :/ / d o c s .d o c k e r .c o m/ g e t - s t a r t e d / d o c k e r _c h e a t s h e e t . p d f 2 IN T 2 0 9 De v Op s run co mma n d : c rea t e a n d run a n ew c on t a in er f rom a n im a g e ❍ T h e c o m m a n d r u n s a c o m m a n d in a n ew c o n t a in er , p u llin g t h e im a g e if n eed ed a n d s t a r t in g t h e c o n t a in er 3 # Run Nginx in background with the name ‘nginx’ docker run --name nginx -d nginx:alpine # Run Busybox and remove the container afterward docker run --name busybox --rm busybox echo “hello world” # Publish (map) port 80 on container to port 3000 on localhost docker run -d -p 3000:80 nginx:alpine # Publish all exposed ports to random ports docker run -d -P nginx:alpine ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /r u n / IN T 2 0 9 De v Op s run co mma n d 4 # Restart the container when daemon startup docker run -d --restart= unless-stopped nginx:alpine sudo systemctl restart docker docker ps # Set environment variables in the container. Can use variables exported in host export firstname=Jack docker run --rm -e firstname --env lastname=Russell busybox env | grep name lastname=Russell firstname=Jack IN T 2 0 9 De v Op s ps co mma n d : l is t c o n t a in e r s ❍ a lia s o f docker container ls ❍ - a , -- a ll s h o w a ll c o n t a in er s ( d ef a u lt s h o w s j u s t r u n n in g ) ❍ - f , -- f ilt er f ilt er o u t p u t b a s ed o n c o n d it io n s p r o v id ed e. g . { n a m e, s t a t u s , a n c es t o r , p u b lis h , ex p o s e} ❍ - q , -- q u iet d is p la y c o n t a in er I D s o n ly 5 # List all containers with the name ‘busybox’ docker ps -a --filter name=busybox # List all containers with the image ‘ubuntu’ or has it as base docker ps --filter ancestor=ubuntu # List all containers that expose port 80 docker ps -f expose=80 # List all containers that publish port 80 docker ps -f publish=80 ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /ls / IN T 2 0 9 De v Op s ps co mma n d Ex e r c is e s 1. Lis t alll ex it ed c on t a in ers 2. Delet e all ex it ed co n t a in e r s in on e co m m a n d [h in t : u s e ‘$( ) ’] 6 IN T 2 0 9 De v Op s exec co mma n d : e xe cu te a c o mmand in a r u nning c o ntaine r 7 # Run Nginx in background with the name ‘nginx’ docker run --name nginx -d nginx:alpine # Execute shell in nginx container docker exec -it nginx sh ps -ef exit # Execute a chained or a quoted command with sh docker exec -it nginx sh -c \"echo a && echo b\" # Run Nginx container with shell docker run nginx:alpine sh ps -ef exit NB : n o n g i n x p r o c es s ! Pr o c e s s w i t h PI D = 1 i s t h e c o n t a i n e r ’ s pr i m a r y pr o c e s s ht t p s : / / d oc s . d oc k e r . c om / r e f e r e nc e / c li/ d oc k e r / c ont a ine r / e x e c / IN T 2 0 9 De v Op s history co mma n d : s ho w the his to r y o f an imag e ❍ a lia s o f docker image history 8 # View image history docker history nginx:alpine IMAGE CREATED CREATED BY SIZE COMMENT 02ffd439b71d 11 months ago /bin/sh -c set -x && apkArch=\"$(cat /etc… 30.8MB <missing> 11 months ago /bin/sh -c #(nop) ENV NJS_VERSION=0.7.11 0B <missing> 11 months ago /bin/sh -c #(nop) CMD [\"nginx\" \"-g\" \"daemon… 0B <missing> 11 months ago /bin/sh -c #(nop) STOPSIGNAL SIGQUIT 0B <missing> 11 months ago /bin/sh -c #(nop) EXPOSE 80 0B <missing> 11 months ago /bin/sh -c #(nop) ENTRYPOINT [\"/docker-entr… 0B <missing> 11 months ago /bin/sh -c #(nop) COPY file:e57eef017a414ca7… 16.4kB <missing> 11 months ago /bin/sh -c #(nop) COPY file:abbcbf84dc17ee44… 12.3kB <missing> 11 months ago /bin/sh -c #(nop) COPY file:5c18272734349488… 12.3kB <missing> 11 months ago /bin/sh -c #(nop) COPY file:7b307b62e82255f0… 8.19kB <missing> 11 months ago /bin/sh -c set -x && addgroup -g 101 -S … 6.85MB <missing> 11 months ago /bin/sh -c #(nop) ENV PKG_RELEASE=1 0B <missing> 11 months ago /bin/sh -c #(nop) ENV NGINX_VERSION=1.23.4 0B <missing> 11 months ago /bin/sh -c #(nop) LABEL maintainer=NGINX Do… 0B <missing> 11 months ago /bin/sh -c #(nop) CMD [\"/bin/sh\"] 0B <missing> 11 months ago /bin/sh -c #(nop) ADD file:e51d4089e73ad6dee… 8.14MB ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /im a g e /h is to r y / IN T 2 0 9 De v Op s history co mma n d 9 # View busybox image history docker history busybox IMAGE CREATED CREATED BY SIZE COMMENT 650fd573e056 10 months ago BusyBox 1.36.1 (glibc), Debian 12 4.17MB # Cannot run busybox without a command docker run --name busybox -d --rm busybox docker ps -a -f name=busybox CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES # May run busybox with sh # NB: need -it option docker run --name busybox -d --rm -it busybox sh docker ps -a -f name=busybox CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4e09b507fe92 busybox \"sh\" 6 seconds ago Up 5 seconds busybox bu s ybo x ha s no d e f a u lt c o m m a nd ! IN T 2 0 9 De v Op s cp co mma n d : c op y f iles / f old ers b et w een a c on t a in er a n d t h e loc a l f iles y s t em ❍ c o n t a in er p a t h s a r e r ela t iv e t o t h e c o n t a in er ' s r o o t d ir ec t o r y 10 docker run --name busybox -d --rm -it busybox sh echo hello world > hello # Copy file ‘hello’ to ‘busybox’ container at /tmp docker cp hello busybox:tmp Successfully copied 2.05kB to busybox:tmp docker exec busybox cat /tmp/hello hello world # Copy file ‘index.html’ in container to host docker cp nginx:usr/share/nginx/html/index.html . ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /c p / IN T 2 0 9 De v Op s E x er c is e 1 : d ep lo y lv m x x y y y in c o n t a in er ❍ C r e at e an d r u n a c o n t ai n e r t o h o s t ‘ l v m x x y y y ’ ❍ Bas e - im a g e : ng inx:alp ine ❍ Name : lvm [x x y y y ] ❍ Re st a r t p o lic y : un les s - st o p p e d ❍ po r t : 0. 0. 0. 0: 3000 ❍ we b - pa g e : lvm x x y y y ❍ c o n t en t : lv m x x y y y . s it . k m u t t . a c . t h 11 IN T 2 0 9 De v Op s commit co mma n d : c rea t e a n ew im a g e f rom a c on t a in er's c h a n g es 12 # commit the changes to the image ‘nginx:test’ docker commit nginx nginx:test # List all images with the image name ‘nginx’ docker images nginx # View history of nginx:test image docker history nginx:test ht t p s : / / do c s . do c k e r. c o m /r e f e r e n c e /c li/d o c k e r /c o n ta in e r /c o m m it/ IN T 2 0 9 De v Op s commit co mma n d Ex e r c is e 1. co m m it lvm x x y y y t o ‘lvm x x y y y : b a r e ’ 13 IN T 2 0 9 De v Op s E x er c is e 2 : f et c h d a t e/ d a t ea p i in c o n t a in er 14 Ba c k - en d Br o ws er Fr o nt - en d fe t c h Jav a w e b ap p l i c at i o n s e rv e r ht m l/ c s s / j s .j ar St a t i c we b s e r ve r :3 0 0 0 :8 0 8 0 /a p i /d a t e /a p p bu ild Fir e w a ll lvm [ xxy y y ]. s i t . k m ut t . a c . t h /a p p bu ild ru n ht t p : 3 0 0 0 ht m l/ c s s / j s /d is t co p y :8 0 .j ar /ta r g e t co p y IN T 2 0 9 De v Op s d a t ea p i c o n t a in er ❍ C r e at e an d r u n a c o n t ai n e r t o h o s t ‘ d at e ap i ’ ❍ Bas e - im a g e : ng inx:alp ine ❍ Name : fe t ch d a t e ❍ Re st a r t p o lic y : un les s - st o p p e d ❍ po r t : 0. 0. 0. 0: 3000 15 IN T 2 0 9 De v Op s f et c h d a t e c o n t a in er ❍ C r e at e an d r u n a c o n t ai n e r t o h o s t ‘ d at e ap i ’ ❍ Bas e - im a g e : op en j d k : 1 7 - jd k - alp ine ❍ Name : da t e a p i ❍ Re st a r t p o lic y : un les s - st o p p e d ❍ po r t : 0. 0. 0. 0: 8080 16","libVersion":"0.3.1","langs":""}